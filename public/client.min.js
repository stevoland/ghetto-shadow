/*! ghetto-shadow - v0.1.0 - 2012-10-19
* https://github.com/stevoland/ghetto-shadow
* Copyright (c) 2012 stevo (Stephen Collings); Licensed MIT */
(function(e,t){function l(e){var t=[];while(e.parentNode){if(e.id){t.unshift("#"+e.id);break}if(e===e.ownerDocument.documentElement||e===e.ownerDocument.body)t.unshift(e.tagName);else{for(var n=1,r=e;r.previousElementSibling;r=r.previousElementSibling,n++);t.unshift(e.tagName+":nth-child("+n+")")}e=e.parentNode}return t.join(" > ")}function c(n){var r,i=!0;if(n.gsElements){r=n.gsElements.length;while(r--)n[n.gsElements[r]]=t.querySelector(n[n.gsElements[r]]),n[n.gsElements[r]]===null&&(i=!1);delete n.gsElements}if(n.gsDocuments){r=n.gsDocuments.length;while(r--)n[n.gsDocuments[r]]=t;delete n.gsDocuments}if(n.gsWindows){r=n.gsWindows.length;while(r--)n[n.gsWindows[r]]=e;delete n.gsWindows}i?(n.gsSimulated=!0,n.type==="change"?h(n):v(n.originalTarget||n.target,n.type,n)):n.gsURI&&(e.location=n.gsURI)}function h(e){e.target.value=e.value}function p(e){var t,n;while(e){if(e.nodeName.toUpperCase()==="A"){t=e;break}e=e.parentNode}return t&&t.href&&(n=t.href),n}function d(r){var i=r||e.event,s={gsElements:[],gsDocuments:[],gsWindows:[],gsURI:p(i.target),gsSimulated:!0},o;if(i.gsSimulated)return!0;for(o in i)o!=="originalTarget"&&o!=="rangeParent"&&(i[o]instanceof HTMLElement?(s[o]=l(i[o]),s.gsElements.push(o)):i[o]===t?(s[o]="document",s.gsDocuments.push(o)):i[o]===e?(s[o]="window",s.gsWindows.push(o)):i[o]===null?s[o]=i[o]:typeof i[o]!="function"&&typeof i[o]!="object"&&(s[o]=i[o]));n.emit("event",s)}function m(e,t,n){var r,i;n?(r=new Date,r.setTime(r.getTime()+n),i="; expires="+r.toGMTString()):i="",document.cookie=e+"="+t+i+"; path=/"}function g(e){var t=e+"=",n=document.cookie.split(";"),r;for(var i=0;i<n.length;i++){r=n[i];while(r.charAt(0)===" ")r=r.substring(1,r.length);if(r.indexOf(t)===0)return r.substring(t.length,r.length)}return null}function y(e){m(e,"",-1)}function b(e){m("gsclick","1",5e3),d(e)}function w(e){e.value=e.target.value,d(e)}var n,r=t.getElementsByTagName("script"),i=r[r.length-1],s=i.src,o,u,a=!1,f=function(){function t(t){var n=e,r=n.parser[n.strictMode?"strict":"loose"].exec(t),i={},s=14;while(s--)i[n.key[s]]=r[s]||"";return i[n.q.name]={},i[n.key[12]].replace(n.q.parser,function(e,t,r){t&&(i[n.q.name][t]=r)}),i}var e={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};return t}(),v=function(e,t){function i(e,t){for(var n in t)e[n]=t[n];return e}function s(e,s){var o=i(r,arguments[2]||{}),u,a=null;for(var f in n)if(n[f].test(s)){a=f;break}if(!a)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");if(document.createEvent)u=document.createEvent(a),a==="HTMLEvents"?u.initEvent(s,o.bubbles,o.cancelable):u.initMouseEvent(s,o.bubbles,o.cancelable,t.defaultView,o.button,o.pointerX,o.pointerY,o.pointerX,o.pointerY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,e),u=i(u,o),e.dispatchEvent(u);else{o.clientX=o.pointerX,o.clientY=o.pointerY;var l=t.createEventObject();u=i(l,o),e.fireEvent("on"+s,u)}return e}var n={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|dblclick|mouse(?:down|up|over|move|out))$/},r={pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0};return s}(e,t);o=f(e.location),u=o.queryKey.gskey||f(i.src).queryKey.gskey,u&&(n=io.connect(),n.on("ready",function(){o.queryKey.gsdriver||g("gsdriver")?(m("gsdriver","1",31536e6),a=!0):y("gsdriver"),a&&!g("gsclick")&&n.emit("href",e.location.href.replace(/(gsdriver=[^&]*)/ig,"")),t.addEventListener("click",b,!1);var r=document.querySelector("input");r.addEventListener("change",w,!1),r.addEventListener("focus",d,!1),r.addEventListener("blur",d,!1)}),n.emit("join",u),n.on("href",function(t){e.location=t}),n.on("event",c))})(window,document);